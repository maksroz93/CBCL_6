<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CBCL 6-18 Digitizer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- MASTER DESIGN (Matches Reference) --- */
        :root {
            --primary: #2563eb;
            --primary-light: #eff6ff;
            --bg-page: #f8fafc;
            --bg-card: #ffffff;
            --border: #cbd5e1;
            --radius: 12px;
            --text-main: #0f172a;
            --text-sub: #475569;
            --danger: #ef4444;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--bg-page); color: var(--text-main);
            margin: 0; padding: 0; padding-bottom: 100px; -webkit-tap-highlight-color: transparent;
        }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }

        /* --- HEADER & TABS --- */
        .header-card {
            background: var(--bg-card); padding: 20px; border-radius: var(--radius);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 20px; border-top: 6px solid var(--primary);
        }
        h1 { margin: 0; font-size: 20px; color: #0f172a; line-height: 1.3; }
        .tab-nav {
            display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; margin-top: 20px; scrollbar-width: none;
        }
        .tab-nav::-webkit-scrollbar { display: none; }
        .tab-btn {
            white-space: nowrap; padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border);
            background: white; color: var(--text-sub); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s;
        }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* --- FORM ELEMENTS --- */
        .form-section { display: none; animation: fadeIn 0.3s; }
        .form-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .card-group {
            background: white; border-radius: var(--radius); padding: 16px; margin-bottom: 16px; border: 1px solid var(--border);
        }
        .card-title { font-size: 16px; font-weight: 700; margin-bottom: 12px; color: #1e293b; }
        
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .full-width { grid-column: 1 / -1; }
        
        .form-label { display: block; font-size: 12px; font-weight: 600; color: var(--text-sub); margin-bottom: 4px; text-transform: uppercase; }
        .form-control, select, textarea {
            width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 8px;
            font-size: 14px; background: #fff; color: var(--text-main); font-family: inherit;
        }
        textarea { resize: vertical; min-height: 60px; }
        
        /* --- DYNAMIC ROWS (Activities) --- */
        .dynamic-row { background: var(--bg-page); padding: 12px; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--border); position: relative;}
        .btn-add { background: white; border: 1px dashed var(--primary); color: var(--primary); width: 100%; padding: 10px; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 10px;}
        .none-check-wrapper { margin-bottom: 15px; display: flex; align-items: center; gap: 8px; background: #f1f5f9; padding: 8px 12px; border-radius: 6px; }

        /* --- SYNDROME ITEMS (Radio Tiles) --- */
        .q-item { background: white; border-bottom: 1px solid var(--border); padding: 16px 0; }
        .q-text { font-size: 15px; font-weight: 500; margin-bottom: 10px; line-height: 1.4; }
        .radio-group { display: flex; gap: 6px; }
        .radio-label { flex: 1; cursor: pointer; position: relative; }
        .radio-label input { position: absolute; opacity: 0; }
        .radio-tile {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 8px 4px; border: 1px solid var(--border); border-radius: 6px; text-align: center;
            height: 100%; min-height: 44px; transition: all 0.2s; background: #f8fafc;
        }
        .radio-label input:checked + .radio-tile { background: var(--primary-light); border-color: var(--primary); color: var(--primary); font-weight: 700; box-shadow: 0 0 0 1px var(--primary); }
        .tile-val { font-size: 14px; margin-bottom: 2px; }
        .tile-desc { font-size: 10px; line-height: 1; }

        /* --- FOOTER --- */
        .footer {
            position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.95);
            backdrop-filter: blur(5px); padding: 12px 20px; border-top: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; z-index: 100;
        }
        .btn-nav { padding: 12px 24px; border-radius: 8px; font-weight: 600; border: none; cursor: pointer; font-size: 15px; }
        .btn-prev { background: #e2e8f0; color: #475569; }
        .btn-next { background: var(--primary); color: white; }
        .btn-next:disabled { background: #94a3b8; cursor: not-allowed; }

        /* Loading Overlay */
        #loading-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(255,255,255,0.9);
            z-index: 200; display: none; align-items: center; justify-content: center; flex-direction: column;
        }
        .spinner { width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<script src="config.js"></script>

<div class="container">
    <div class="header-card">
        <h1 id="form-title">CBCL Loading...</h1>
        <div class="tab-nav" id="tab-nav"></div>
    </div>

    <form id="cbclForm">
        <div id="form-body"></div>
    </form>
</div>

<div class="footer">
    <button type="button" class="btn-nav btn-prev" id="btnPrev" onclick="changeStep(-1)">Back</button>
    <div id="progress-txt" style="font-size:12px; color:#64748b; font-weight:600;"></div>
    <button type="button" class="btn-nav btn-next" id="btnNext" onclick="changeStep(1)">Next</button>
</div>

<div id="loading-overlay">
    <div class="spinner"></div>
    <div style="margin-top:15px; font-weight:600; color:#334155;">Saving Data...</div>
</div>

<script>
    let currentStep = 0;
    const formData = {}; // Store raw answers here

    // --- INITIALIZATION ---
    window.onload = function() {
        if (typeof CONFIG === 'undefined') {
            alert("Error: config.js not found!"); return;
        }
        initUI();
        renderForm();
        updateNav();
    };

    function initUI() {
        document.getElementById('form-title').innerText = CONFIG.ui.title;
        document.getElementById('btnPrev').innerText = CONFIG.ui.btnPrev;
        document.getElementById('btnNext').innerText = CONFIG.ui.btnNext;
        
        // Build Tabs
        const nav = document.getElementById('tab-nav');
        CONFIG.ui.tabs.forEach((t, i) => {
            const btn = document.createElement('div');
            btn.className = `tab-btn ${i===0 ? 'active' : ''}`;
            btn.innerText = t;
            btn.onclick = () => jumpToStep(i);
            nav.appendChild(btn);
        });
    }

    function renderForm() {
        const body = document.getElementById('form-body');
        
        // 1. DEMOGRAPHICS
        body.innerHTML += `<div class="form-section active" id="step-0">
            <div class="card-group">
                <div class="card-title">Загальна інформація</div>
                <div class="input-grid" id="demo-grid"></div>
            </div>
        </div>`;
        const demoGrid = document.getElementById('demo-grid');
        CONFIG.demographics.fields.forEach(f => {
            const div = document.createElement('div');
            if(f.type === 'text' && (f.id === 'parentName' || f.id === 'childName')) div.className = 'full-width';
            
            let inputHtml = '';
            if(f.type === 'select') {
                inputHtml = `<select id="${f.id}" class="form-control">
                    <option value="">Choose...</option>
                    ${f.options.map(o => `<option value="${o}">${o}</option>`).join('')}
                </select>`;
            } else {
                inputHtml = `<input type="${f.type}" id="${f.id}" class="form-control" ${f.required?'required':''}>`;
            }
            div.innerHTML = `<label class="form-label">${f.label}</label>${inputHtml}`;
            demoGrid.appendChild(div);
        });

        // 2. ACTIVITIES (Sports, Hobbies, Orgs, Chores)
        let actHtml = `<div class="form-section" id="step-1">`;
        ['sports', 'hobbies', 'orgs', 'chores'].forEach(key => {
            const conf = CONFIG.competence.activities[key];
            actHtml += `
            <div class="card-group">
                <div class="card-title">${conf.title}</div>
                <div style="font-size:13px; color:#64748b; margin-bottom:10px;">${conf.desc}</div>
                <div class="none-check-wrapper">
                    <input type="checkbox" id="no_${key}" onchange="toggleActivity('${key}')">
                    <label for="no_${key}">${conf.noneLabel}</label>
                </div>
                <div id="container-${key}"></div>
                <button type="button" class="btn-add" id="btn-add-${key}" onclick="addActivityRow('${key}')">+ Додати</button>
            </div>`;
        });
        actHtml += `</div>`;
        body.innerHTML += actHtml;

        // 3. SOCIAL
        const soc = CONFIG.competence.social;
        let socHtml = `<div class="form-section" id="step-2">
            <div class="card-group">
                <div class="card-title">V. Друзі</div>
                <label class="form-label">${soc.q1.label}</label>
                <select id="${soc.q1.id}" class="form-control" style="margin-bottom:15px;">
                    ${soc.q1.opts.map(o => `<option>${o}</option>`).join('')}
                </select>
                <label class="form-label">${soc.q2.label}</label>
                <select id="${soc.q2.id}" class="form-control">
                    ${soc.q2.opts.map(o => `<option>${o}</option>`).join('')}
                </select>
            </div>
            <div class="card-group">
                <div class="card-title">${soc.relations.title}</div>
                ${soc.relations.items.map((it, idx) => `
                    <div style="margin-bottom:15px;">
                        <label class="form-label" style="text-transform:none;">${it}</label>
                        <div class="radio-group">
                            ${soc.relations.opts.map((opt, val) => `
                                <label class="radio-label">
                                    <input type="radio" name="rel_${idx}" value="${val}">
                                    <div class="radio-tile" style="padding:6px;"><span class="tile-val" style="font-size:12px;">${opt}</span></div>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>`;
        body.innerHTML += socHtml;

        // 4. SCHOOL
        const sch = CONFIG.competence.school;
        let schHtml = `<div class="form-section" id="step-3">
            <div class="card-group">
                <div class="card-title">${sch.title}</div>
                ${sch.subjects.map((subj, i) => `
                    <div class="dynamic-row">
                        <div style="font-weight:600; font-size:14px; margin-bottom:5px;">${subj}</div>
                        <div class="radio-group">
                             ${sch.grades.map((g, v) => `
                                <label class="radio-label">
                                    <input type="radio" name="subj_${i}" value="${v}">
                                    <div class="radio-tile" style="padding:4px;"><span class="tile-desc" style="font-size:10px;">${g}</span></div>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `).join('')}
            </div>
            <div class="card-group">
                <div class="card-title">Додаткова інформація</div>
                ${sch.extraQs.map(q => `
                    <div style="margin-bottom:15px;">
                        <label class="form-label">${q.label}</label>
                        <select id="${q.id}" class="form-control" onchange="toggleDetail('${q.id}_det', this.value)">
                            <option value="0">Ні</option>
                            <option value="1">Так</option>
                        </select>
                        <div id="${q.id}_det" style="display:none; margin-top:8px;">
                            <input type="text" id="${q.id}_text" class="form-control" placeholder="${q.detail}">
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>`;
        body.innerHTML += schHtml;

        // 5. SYNDROMES (The 113 Questions)
        let syndHtml = `<div class="form-section" id="step-4">
            <div style="background:#fff7ed; border:1px solid #fdba74; padding:12px; border-radius:8px; margin-bottom:16px; font-size:13px; color:#c2410c;">
                <strong>Інструкція:</strong> ${CONFIG.ui.instructions}
            </div>
            <div class="card-group">`;
        
        CONFIG.questions.forEach((qText, idx) => {
            syndHtml += `
            <div class="q-item">
                <div class="q-text">${qText}</div>
                <div class="radio-group">
                    <label class="radio-label"><input type="radio" name="p_${idx}" value="0"><div class="radio-tile"><span class="tile-val">0</span><span class="tile-desc">Ні</span></div></label>
                    <label class="radio-label"><input type="radio" name="p_${idx}" value="1"><div class="radio-tile"><span class="tile-val">1</span><span class="tile-desc">Інколи</span></div></label>
                    <label class="radio-label"><input type="radio" name="p_${idx}" value="2"><div class="radio-tile"><span class="tile-val">2</span><span class="tile-desc">Часто</span></div></label>
                </div>
            </div>`;
        });
        syndHtml += `</div></div>`;
        body.innerHTML += syndHtml;

        // Init Dynamic Rows
        ['sports', 'hobbies', 'orgs', 'chores'].forEach(k => addActivityRow(k));
    }

    // --- DYNAMIC UI LOGIC ---
    function addActivityRow(key) {
        const container = document.getElementById(`container-${key}`);
        const conf = CONFIG.competence.activities[key];
        const div = document.createElement('div');
        div.className = 'dynamic-row';
        
        let rowInner = `<input type="text" class="form-control act-name" placeholder="${conf.cols[0]}" style="margin-bottom:8px;">`;
        
        // Render Dropdowns based on config type
        if(key === 'sports' || key === 'hobbies') {
            rowInner += `<div class="input-grid">
                <select class="form-control act-time"><option value="">Час...</option>${conf.optsTime.map((o,i)=>`<option value="${i}">${o}</option>`).join('')}</select>
                <select class="form-control act-skill"><option value="">Успіхи...</option>${conf.optsSkill.map((o,i)=>`<option value="${i}">${o}</option>`).join('')}</select>
            </div>`;
        } else if (key === 'orgs') {
            rowInner += `<select class="form-control act-perf"><option value="">Активність...</option>${conf.optsActivity.map((o,i)=>`<option value="${i}">${o}</option>`).join('')}</select>`;
        } else if (key === 'chores') {
            rowInner += `<select class="form-control act-perf"><option value="">Якість...</option>${conf.optsQuality.map((o,i)=>`<option value="${i}">${o}</option>`).join('')}</select>`;
        }
        
        div.innerHTML = rowInner;
        container.appendChild(div);
    }

    function toggleActivity(key) {
        const isChecked = document.getElementById(`no_${key}`).checked;
        const cont = document.getElementById(`container-${key}`);
        const btn = document.getElementById(`btn-add-${key}`);
        cont.style.opacity = isChecked ? '0.5' : '1';
        cont.style.pointerEvents = isChecked ? 'none' : 'auto';
        btn.style.display = isChecked ? 'none' : 'block';
        if(isChecked) {
            cont.querySelectorAll('input, select').forEach(el => el.value = '');
        }
    }

    function toggleDetail(id, val) {
        document.getElementById(id).style.display = (val === "1") ? "block" : "none";
    }

    // --- NAVIGATION ---
    function jumpToStep(n) {
        document.querySelectorAll('.form-section').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(e => e.classList.remove('active'));
        document.getElementById(`step-${n}`).classList.add('active');
        document.querySelectorAll('.tab-btn')[n].classList.add('active');
        currentStep = n;
        updateNav();
        window.scrollTo(0,0);
    }

    function changeStep(dir) {
        if(dir === 1 && currentStep === 4) { submitForm(); return; }
        const next = currentStep + dir;
        if(next >= 0 && next <= 4) jumpToStep(next);
    }

    function updateNav() {
        document.getElementById('progress-txt').innerText = `Step ${currentStep+1}/5`;
        const btnNext = document.getElementById('btnNext');
        if(currentStep === 4) {
            btnNext.innerText = CONFIG.ui.btnSubmit;
            btnNext.style.background = '#10b981';
        } else {
            btnNext.innerText = CONFIG.ui.btnNext;
            btnNext.style.background = '#2563eb';
        }
        document.getElementById('btnPrev').disabled = (currentStep === 0);
    }

   // --- SUBMISSION & SCORING ---
    function submitForm() {
        console.log("Starting Submission...");

        // 1. VALIDATION: Check for required fields defined in CONFIG
        // This prevents sending empty forms
        const req = CONFIG.demographics.fields.filter(f => f.required).map(f => f.id);
        let missing = [];
        req.forEach(id => {
            const el = document.getElementById(id);
            if (!el || !el.value.trim()) missing.push(id);
        });

        if (missing.length > 0) {
            alert("Please fill in all required fields: " + missing.join(", "));
            jumpToStep(0); // Jump back to the first tab
            return;
        }

        // Show loading spinner
        document.getElementById('loading-overlay').style.display = 'flex';

        // 2. SAFETY CHECK: Explicitly grab Child Name
        // This fixes the "Child: undefined" error in your result page
        const nameEl = document.getElementById('childName');
        const childNameVal = nameEl ? nameEl.value.trim() : "Unknown Child";

        // 3. INITIALIZE DATA STRUCTURE
        const data = {
            meta: {},
            activities: { sports: [], hobbies: [], orgs: [], chores: [] },
            social: { relations: [] },
            school: { grades: [] },
            syndromes: {} 
        };

        // Gather Demographics
        CONFIG.demographics.fields.forEach(f => {
            const el = document.getElementById(f.id);
            if (el) data.meta[f.id] = el.value;
        });
        // Force the child name into meta to be safe
        data.meta.childName = childNameVal;

        // Gather Activities (Sports, Hobbies, Orgs, Chores)
        ['sports', 'hobbies', 'orgs', 'chores'].forEach(k => {
            const checkbox = document.getElementById(`no_${k}`);
            // Only gather data if the "None" checkbox is NOT checked
            if (checkbox && !checkbox.checked) {
                document.querySelectorAll(`#container-${k} .dynamic-row`).forEach(row => {
                    const nameInput = row.querySelector('.act-name');
                    // Only add if user typed a name
                    if (nameInput && nameInput.value.trim()) {
                        const item = { name: nameInput.value.trim() };
                        
                        // Grab dropdown values safely
                        const t = row.querySelector('.act-time');
                        const s = row.querySelector('.act-skill');
                        const p = row.querySelector('.act-perf');
                        
                        if (t && t.selectedIndex > 0) item.time = t.options[t.selectedIndex].text;
                        if (s && s.selectedIndex > 0) item.skill = s.options[s.selectedIndex].text;
                        if (p && p.selectedIndex > 0) item.perf = p.options[p.selectedIndex].text;
                        
                        data.activities[k].push(item);
                    }
                });
            }
        });

        // Gather Social Data
        const friendsCount = document.getElementById('friends_count');
        const friendsFreq = document.getElementById('friends_freq');
        data.social.friends = friendsCount ? friendsCount.value : "-";
        data.social.freq = friendsFreq ? friendsFreq.value : "-";

        CONFIG.competence.social.relations.items.forEach((_, i) => {
            const el = document.querySelector(`input[name="rel_${i}"]:checked`);
            data.social.relations.push(el ? el.value : "-");
        });

        // Gather School Data
        CONFIG.competence.school.subjects.forEach((_, i) => {
            const el = document.querySelector(`input[name="subj_${i}"]:checked`);
            data.school.grades.push(el ? el.value : "-");
        });
        
        CONFIG.competence.school.extraQs.forEach(q => {
             const valEl = document.getElementById(q.id);
             const detEl = document.getElementById(`${q.id}_text`);
             const val = valEl ? valEl.value : "0";
             // If "Yes" (1), save the detail text. Otherwise "No".
             data.school[q.id] = (val === '1' && detEl) ? detEl.value : "No";
        });

        // Gather Syndromes (113 Questions)
        // Default to 0 if unchecked to prevent math errors later
        CONFIG.questions.forEach((_, i) => {
            const el = document.querySelector(`input[name="p_${i}"]:checked`);
            data.syndromes[i] = el ? parseInt(el.value) : 0;
        });

        // 4. CALCULATE SCORES
        const scores = {};
        
        // A. Calculate 8 Syndrome Scales (Standard)
        for(const [scaleName, indices] of Object.entries(CONFIG.map)) {
            let sum = 0;
            indices.forEach(idx => {
                let lookupIdx = idx;
                // Handle "56a" etc. strings if present in config
                if(typeof idx === 'string') lookupIdx = CONFIG.questions.findIndex(q => q.startsWith(idx));
                sum += (data.syndromes[lookupIdx] || 0);
            });
            scores[scaleName] = sum;
        }

        // B. Calculate Broad Band Scales
        // Internalizing = Anxious + Withdrawn + Somatic
        scores["Internalizing"] = 
            (scores["Anxious/Depressed"] || 0) + 
            (scores["Withdrawn/Depressed"] || 0) + 
            (scores["Somatic Complaints"] || 0);

        // Externalizing = Rule-Breaking + Aggressive
        scores["Externalizing"] = 
            (scores["Rule-Breaking Behavior"] || 0) + 
            (scores["Aggressive Behavior"] || 0);

        // C. Calculate Total Problems (Sum of ALL 113 Items)
        let totalSum = 0;
        Object.values(data.syndromes).forEach(val => {
            totalSum += (val || 0);
        });
        scores["Total Problems"] = totalSum;

        // 5. CONSTRUCT FINAL PAYLOAD
        // Generate Link: Get current folder URL + lookup.html?id=...
        // This works for localhost and web hosting
        const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
        const uniqueID = Date.now().toString();
        const reportLink = `${baseUrl}lookup.html?id=${uniqueID}`;

        const payload = {
            id: uniqueID,
            child: childNameVal,
            link: reportLink, // <--- SENDING THE LINK HERE
            scores: scores,
            fullData: JSON.stringify(data),
            meta: data.meta
        };

        console.log("Payload prepared:", payload);

        // 6. SEND TO GOOGLE SCRIPT
        // CRITICAL FIX: 'no-cors' mode and NO custom headers
        fetch(CONFIG.GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', 
            // headers: { 'Content-Type': 'application/json' }, // <-- THIS LINE MUST BE REMOVED/COMMENTED OUT
            body: JSON.stringify(payload)
        }).then(() => {
            console.log("Request sent successfully.");
            
            // Save to LocalStorage so result.html can display it immediately
            localStorage.setItem('cbcl_result', JSON.stringify(payload));
            
            // Redirect to results
            window.location.href = 'result.html';
        }).catch(err => {
            console.error("Transmission Error:", err);
            alert("Error sending data. Please check your internet connection or Script URL.\nDetails: " + err.message);
            document.getElementById('loading-overlay').style.display = 'none';
        });
    }
</script>
<button onclick="autoFill()" style="position:fixed; bottom:80px; right:20px; z-index:999; background:#dc2626; color:white; border:none; padding:10px 15px; border-radius:50px; font-weight:bold; box-shadow:0 4px 12px rgba(0,0,0,0.3); cursor:pointer;">
    ⚡ TEST FILL
</button>

<script>
function autoFill() {
    // 1. Fill Text/Date Inputs
    document.getElementById('childName').value = "Test Child " + Math.floor(Math.random()*1000);
    document.getElementById('parentName').value = "Test Parent";
    document.getElementById('dob').value = "2015-06-15";
    document.getElementById('fillDate').value = new Date().toISOString().split('T')[0];
    document.getElementById('gender').value = "Хлопець";
    
    // 2. Randomize Radio Buttons (Relations & Syndromes)
    const radios = document.querySelectorAll('input[type="radio"]');
    const groups = new Set();
    radios.forEach(r => groups.add(r.name));
    
    groups.forEach(name => {
        const options = document.querySelectorAll(`input[name="${name}"]`);
        // Bias towards 0 (No) for syndromes so we don't get crazy high scores, but mix in some 1s and 2s
        const rand = Math.random();
        let idx = 0;
        if(rand > 0.7) idx = 1;
        if(rand > 0.9) idx = 2;
        if(options[idx]) options[idx].checked = true;
    });

    // 3. Fill Dropdowns
    document.querySelectorAll('select').forEach(s => {
        if(s.options.length > 1) s.selectedIndex = 1;
        // Trigger change for dynamic fields
        s.dispatchEvent(new Event('change')); 
    });

    // 4. Fill Dynamic Text Inputs (Sports/Hobbies)
    document.querySelectorAll('input.act-name').forEach(i => i.value = "Test Activity");

    // 5. Jump to last step
    jumpToStep(4);
    alert("✅ Form filled with test data!");
}
</script>
</body>
</html>